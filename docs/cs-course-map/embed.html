<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.21.0/cytoscape.min.js"></script>
    <script src="https://unpkg.com/layout-base/layout-base.js"></script>
    <script src="https://unpkg.com/cose-base/cose-base.js"></script>
    <script src="https://unpkg.com/cytoscape-fcose/cytoscape-fcose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-layout-utilities@1.1.1/cytoscape-layout-utilities.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
    <style>
        html, body {
            background: transparent;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #cy {
            width: 100%;
            height: 100vh;
            display: block;
        }
    </style>
</head>
<body>
<div id="cy"></div>
<script>

    var courseData = [
        // Compound nodes
        { data: { id: 'math', type: 'compound' } },
        { data: { id: 'core', type: 'compound' } },
        { data: { id: 'hardware', type: 'compound' } },
        { data: { id: 'software', type: 'compound' } },
        { data: { id: 'theory', type: 'compound' } },
        { data: { id: 'applications', type: 'compound' } },
        { data: { id: 'elective', type: 'compound' } },
        { data: { id: 'stat', type: 'compound' } },

        // Nodes with parent
        { data: { id: '200', optional: 'true' } },

        { data: { id: '203', parent: 'hardware' } },
        { data: { target: '203', source: '221' } },

        { data: { id: '221', parent: 'math' } },

        { data: { id: '222', parent: 'math' } },
        { data: { target: '222', source: '221' } },

        { data: { id: '234', parent: 'math' } },
        { data: { target: '234', source: '222' } },

        { data: { id: 's240', parent: 'stat', label: '240'} },

        { data: { id: '240', parent: 'core', label: '240'} },
        { data: { target: '240', source: '221' } },

        { data: { id: '252', parent: 'core' } },

        { data: { id: '300', parent: 'core' } },
        { data: { target: '300', source: '200' } },
        { data: { target: '300', source: '200' } },

        { data: { id: '301', parent: 'stat' } },

        { data: { id: '309', parent: 'stat' } },
        { data: { target: '309', source: '234' } },

        { data: { id: '310', optional: 'true' } },
        { data: { target: '310', source: '222' } },

        { data: { id: 's310', label: '310', parent: 'stat' } },
        { data: { target: 's310', source: '301' } },
        { data: { target: 's310', source: '309' } },

        { data: { id: '324', parent: 'stat' } },
        { data: { target: '324', source: '221' } },

        { data: { id: '330', parent: 'hardware' } },
        { data: { target: '330', source: '203' } },

        { data: { id: 's340', parent: 'stat', label: '340'} },
        { data: { target: 's340', source: 's240'} },
        { data: { target: 's340', source: '221'} },

        { data: { id: 'm340', parent: 'math', label: '340'} },
        { data: { target: 'm340', source: '222'} },

        { data: { id: '352', parent: 'hardware' } },
        { data: { target: '352', source: '252' } },

        { data: { id: '354', parent: 'core' } },
        { data: { target: '354', source: '252' } },
        { data: { target: '354', source: '300' } },

        { data: { id: '400', parent: 'core' } },
        { data: { target: '400', source: '300' } },

        { data: { id: '407', parent: 'software' } },
        { data: { target: '407', source: '400' } },

        { data: { id: '412', parent: 'applications' } },
        { data: { target: '412', source: '222' } },
        { data: { target: '412', source: '240'} },
        { data: { target: '412', source: '300' } },
        { data: { target: '412', source: 'm340', type: 'recommended' } },

        { data: { id: '421', parent: 'math' } },
        { data: { target: '421', source: '234'} },

        { data: { id: '425', parent: 'applications' } },
        { data: { target: '425', source: 'm340'} },

        { data: { id: '435', parent: 'elective' } },
        { data: { target: '435', source: 'm340' } },

        { data: { id: '471', parent: 'elective' } },
        { data: { target: '471', source: 's340' } },
        { data: { target: '471', source: 's310' } },

        { data: { id: '475', parent: 'elective' } },
        { data: { target: '475', source: 'm340' } },

        { data: { id: '506', parent: 'software' } },
        { data: { target: '506', source: '400' } },
        { data: { target: '506', source: '537', type: 'recommended' } },

        { data: { id: '513', parent: 'applications' } },
        { data: { target: '513', source: '300' } },
        { data: { target: '513', source: 'm340'} },

        { data: { id: '514', parent: 'applications' } },
        { data: { target: '514', source: 'm340'} },
        { data: { target: '514', source: '300' } },
        { data: { target: '514', source: '421' } },

        { data: { id: '518', parent: 'elective' } },

        { data: { id: '520', parent: 'theory' } },
        { data: { target: '520', source: '240' } },
        { data: { target: '520', source: '400' } },

        { data: { id: '524', parent: 'applications' } },
        { data: { target: '524', source: '300' } },
        { data: { target: '524', source: 'm340' } },

        { data: { id: '525', parent: 'applications' } },
        { data: { target: '525', source: 'm340' } },

        { data: { id: '526', parent: 'elective' } },
        { data: { target: '526', source: '525' } },

        { data: { id: '532', parent: 'elective' } },
        { data: { target: '532', source: '300' } },
        { data: { target: '532', source: 'm340' } },

        { data: { id: '533', parent: 'elective' } },
        { data: { target: '533', source: '330' } },
        { data: { target: '533', source: 'm340' } },

        { data: { id: '534', parent: 'applications' } },
        { data: { target: '534', source: '300' } },
        { data: { target: '534', source: '221' } },

        { data: { id: '536', parent: 'software' } },
        { data: { target: '536', source: '354' } },
        { data: { target: '536', source: '400' } },

        { data: { id: '537', parent: 'software' } },
        { data: { target: '537', source: '354' } },
        { data: { target: '537', source: '400' } },

        { data: { id: '538', parent: 'software' } },
        { data: { target: '538', source: '354' } },
        { data: { target: '538', source: '400' } },

        { data: { id: '539', parent: 'elective' } },
        { data: { target: '539', source: '300' } },

        { data: { id: '540', parent: 'applications' } },
        { data: { target: '540', source: '300' } },
        { data: { target: '540', source: '221' } },

        { data: { id: '541', parent: 'elective' } },
        { data: { target: '541', source: 's340' } },
        { data: { target: '541', source: 'm340' } },

        { data: { id: '542', parent: 'software' } },
        { data: { target: '542', source: '400' } },

        { data: { id: '544', parent: 'software' } },
        { data: { target: '544', source: '400' } },

        { data: { id: '551', parent: 'hardware' } },
        { data: { target: '551', source: '352' } },

        { data: { id: '552', parent: 'hardware' } },
        { data: { target: '552', source: '352' } },
        { data: { target: '552', source: '354' } },
        { data: { target: '552', source: '551', type: 'recommended' } },

        { data: { id: '558', parent: 'elective' } },
        { data: { target: '558', source: '400' } },
        { data: { target: '558', source: '234' } },

        { data: { id: '559', parent: 'applications' } },
        { data: { target: '559', source: '222' } },
        { data: { target: '559', source: '234', type: 'recommended' } },
        { data: { target: '559', source: 'm340', type: 'recommended' } },
        { data: { target: '559', source: '400' } },

        { data: { id: '561', parent: 'elective' } },
        { data: { target: '561', source: '324' } },
        { data: { target: '561', source: 'm340' } },

        { data: { id: '564', parent: 'software' } },
        { data: { target: '564', source: '354' } },
        { data: { target: '564', source: '400' } },

        { data: { id: '565', parent: 'applications' } },
        { data: { target: '565', source: '400' } },

        { data: { id: '566', parent: 'applications' } },
        { data: { target: '566', source: '400' } },
        { data: { target: '566', source: 'm340' } },
        { data: { target: '566', source: '324'} },

        { data: { id: '567', parent: 'elective' } },
        { data: { target: '567', source: '310', type: 'recommended' } },
        { data: { target: '567', source: 'm340', } },
        { data: { target: '567', source: '324', } },

        { data: { id: '570', parent: 'applications' } },
        { data: { target: '570', source: '300' } },

        { data: { id: '571', parent: 'applications' } },
        { data: { target: '571', source: '400' } },

        { data: { id: '576', parent: 'elective' } },
        { data: { target: '576', source: '400' } },

        { data: { id: '577', parent: 'theory' } },
        { data: { target: '577', source: '240' } },
        { data: { target: '577', source: '400' } },

        { data: { id: '579', parent: 'elective' } },
        { data: { target: '579', source: '559', type: 'recommended' } },

        { data: { id: '635', parent: 'elective' } },
        { data: { target: '635', source: 'm340' } },
        { data: { target: '635', source: '300' } },

        { data: { id: '639', parent: 'elective' } },

        { data: { id: '640', parent: 'software' } },
        { data: { target: '640', source: '537' } },

        { data: { id: '642', parent: 'software' } },
        { data: { target: '642', source: '537' } },
        { data: { target: '642', source: '240' , type: 'recommended'} },


    ];

    document.addEventListener('DOMContentLoaded', function() {
        let cy = cytoscape({
            container: document.getElementById('cy'),

            elements: courseData,

            style: [
                {
                    selector: 'node',
                    style: {
                        'label': data => data.data('label') || data.id(),
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'background-color': '#757575',
                        'padding': 10
                    }
                },
                {
                    selector: 'node[type="compound"]',
                    style: {
                        'text-valign': 'top',
                        'border-width': 0,
                        'background-opacity': 0,
                        label: '',
                    }
                },
                {
                    selector: 'node[optional="true"]',
                    style: {
                        'border-width': 1,
                        'border-color': '#000',
                        'border-style': 'dashed',
                        'opacity': 0.5,
                    }
                },
                {
                    selector: 'node[parent="core"]',
                    style: {
                        'background-color': '#ff7373',
                    }
                },
                {
                    selector: 'node[parent="hardware"]',
                    style: {
                        'background-color': '#fff176',
                    }
                },
                {
                    selector: 'node[parent="software"]',
                    style: {
                        'background-color': '#90CAF9',
                    }
                },
                {
                    selector: 'node[parent="theory"]',
                    style: {
                        'background-color': '#80CBC4',
                    }
                },
                {
                    selector: 'node[parent="applications"]',
                    style: {
                        'background-color': '#CE93D8',
                    }
                },
                {
                    selector: 'node[parent="elective"]',
                    style: {
                        'background-color': '#EEEEEE',
                    }
                },
                {
                    selector: 'node[parent="math"]',
                    style: {
                        'background-color': '#C5E1A5',
                    }
                },
                {
                    selector: 'node[parent="stat"]',
                    style: {
                        'background-color': '#E6EE9C',
                    }
                },
                {
                    selector: 'edge[type="anyOneOf"]',
                    style: {
                        'line-style': 'dotted'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 1,
                        'line-color': '#000',
                        'curve-style': 'straight',
                        'target-arrow-color': '#000',
                        'target-arrow-shape': 'triangle',
                        'source-distance-from-node': 5,
                        'target-distance-from-node': 5,
                        'text-wrap': 'wrap',
                        'font-size': 10,
                    }
                },
                {
                    selector: 'edge[type="recommended"]',
                    style: {
                        'line-style': 'dashed',
                    }
                },
                {
                    selector: '.highlighted-nodes',
                    style: {
                        'border-width': 1,
                        'border-color': '#000',
                        'border-style': 'solid',
                    }
                },
                {
                    selector: '.highlighted-edges',
                    style: {
                        'width': 2,
                    }
                },
                {
                    selector: '.faded',
                    style: {
                        'opacity': 0.25,
                        'text-opacity': 0.25,
                    }
                },
                {
                    selector: '*',
                    style: {
                        'transition-property': 'opacity',
                        'transition-duration': '0.2s',
                    }
                },

            ],

            layout: {
                name: 'breadthfirst',
                directed: true,
                padding: 10,
                roots: '300'
            }

        });

        cy.layout({
            name: 'fcose',
            quality: 'proof', // 'draft', 'default' or 'proof'
            animate: true, // Whether to animate the layout
            animationDuration: 1000, // Duration of the animation in milliseconds
            animationEasing: 'ease-out', // Easing of the animation
            fit: true, // Whether to fit the viewport to the graph
            padding: 30, // Padding around the layout
            nodeDimensionsIncludeLabels: true, // Excludes the label when calculating node bounding boxes for the layout algorithm
            uniformNodeDimensions: true, // Specifies whether the node dimensions should be uniform
            packComponents: true, // Pack connected components - usually for graphs with multiple components
            nodeRepulsion: 35000, // Node repulsion (non overlapping) multiplier
            idealEdgeLength: 50, // Ideal edge (non nested) length
            edgeElasticity: 0.45, // Divisor to compute edge forces
            nestingFactor: 1, // Nesting factor (multiplier) to compute ideal edge length for nested edges
            infinite: true, // Overrides the maximum number of iterations
            gravity: 1000,
            gravityRangeCompound: 1,
            gravityCompound: 100,
            gravityRange: 1.5,
            initialEnergyOnIncremental: 1,
            // edgeElasticity: 0.45, // Edge elasticity factor
            // nestingFactor: 0.1, // Nesting factor (multiplier) to compute ideal edge length for nested edges
            // gravity: 0.25, // Gravity factor
            // numIter: 9000, // Maximum number of iterations
            // gravityCompound: 900,
            // tile: true, // Whether to use tiling to avoid node overlaps
            // tilingPaddingVertical: 10, // Padding between the tiles (vertical)
            // tilingPaddingHorizontal: 10, // Padding between the tiles (horizontal)
            // packComponents: true, // Whether to pack disconnected components
            randomize: false, // Whether to randomize the initial positions of nodes
            // componentSpacing: 300, // Spacing between disconnected components
            // nodeDimensionsIncludeLabels: true, // Whether to include labels in node dimensions
            // uniformNodeDimensions: true, // Whether to use uniform node dimensions for all nodes
            // minNodeSpacing: 50, // Minimum spacing between nodes
            // samplingType: true, // Whether to use sampling to handle large graphs
            // sampleSize: 10, // Sample size for sampling
            // sampleSeed: 1, // Seed for sampling
            // randomizeSampling: false, // Whether to randomize sampling
            // sampleByComponent: true, // Whether to sample by component
            fixedNodeConstraint: [
                // {
                //     nodeId: '240',
                //     position: { x: -100, y: -100 }
                // },
                // {
                //     nodeId: '252',
                //     position: { x: -100, y: 100 }
                // },
                {
                    nodeId: '300',
                    position: { x: -100, y: 0 }
                },
                {
                    nodeId: '400',
                    position: { x: 100, y: 0 }
                }
            ],
            alignmentConstraint: {
                vertical: [
                ],
                horizontal: [
                    ['221', '222'],
                    ['300', '400']
                ]
            },
            relativePlacementConstraint: [
                { left: '200', right : '300', gap: 100 },
                { left: '221', right : '222', gap: 200 },
            ]
        }).run();

        cy.on('mouseover', 'node', function(event) {
            const targetNode = event.target;
            highlightPath(targetNode);
        });

        cy.on('mouseout', 'node', function(event) {
            cy.nodes().removeClass('highlighted-nodes');
            cy.elements().removeClass('faded');
            cy.edges().removeClass('highlighted-edges');
        });

        function highlightPath(node) {

            if (node.data('type') === 'compound') {
                return;
            }

            const incomingNodes = node.predecessors('node').union(node);
            const incomingEdges = node.predecessors('edge');

            const outgoingNodes = node.outgoers('node').union(node);
            const outgoingEdges = node.outgoers('edge');
            
            const highlightedNodes = incomingNodes.union(outgoingNodes);
            const highlightedEdges = incomingEdges.union(outgoingEdges);

            highlightedNodes.addClass('highlighted-nodes');
            highlightedEdges.addClass('highlighted-edges');

            const nonCompoundNodes = cy.nodes().filter(function(node) {
                return node.data('type') !== 'compound';
            });


            const fadeNodes = nonCompoundNodes.difference(highlightedNodes);
            const fadeEdges = cy.edges().difference(highlightedEdges);
            fadeNodes.addClass('faded');
            fadeEdges.addClass('faded');

        }
    });

</script>
</body>
</html>
